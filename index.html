<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IST 131: Late for Class - Penn State Platformer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #001a4d 0%, #003366 100%);
            font-family: Arial, sans-serif;
            color: white;
        }
        
        .container {
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            color: #ffdb58;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            margin-bottom: 20px;
            font-size: 14px;
            color: #b0b0b0;
        }
        
        canvas {
            border: 4px solid white;
            background-color: #87ceeb;
            display: block;
            margin: 0 auto;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        .info {
            margin-top: 20px;
            font-size: 14px;
        }
        
        .controls {
            margin-top: 15px;
            padding: 15px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 5px;
        }
        
        .grade-display {
            margin-top: 20px;
            font-size: 18px;
            padding: 15px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 5px;
            display: none;
        }
        
        .grade-display.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶Å IST 131: Late for Class ü¶Å</h1>
        <p class="subtitle">A Penn State Platformer Adventure</p>
        <canvas id="gameCanvas" width="1000" height="600"></canvas>
        
        <div class="controls">
            <p><strong>Controls:</strong></p>
            <p>‚Üê ‚Üí Arrow Keys or A/D to move | SPACEBAR to jump</p>
            <p>Collect all Lion Tokens! ü¶Å Reach the Professor to finish!</p>
        </div>
        
        <div class="info">
            <p>Tokens Collected: <span id="tokenCount">0</span> / <span id="tokenTotal">0</span></p>
        </div>
        
        <div class="grade-display" id="gradeDisplay">
            <div id="gradeContent"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game constants
        const GRAVITY = 0.6;
        const PLAYER_SPEED = 5;
        const JUMP_STRENGTH = -12;
        const GROUND_Y = canvas.height - 100;
        
        // Game state
        let gameActive = true;
        let tokensCollected = 0;
        let totalTokens = 0;
        
        // Input handling
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key === ' ') e.preventDefault();
        });
        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        // Player object
        const player = {
            x: 50,
            y: GROUND_Y,
            width: 20,
            height: 32,
            velocityY: 0,
            velocityX: 0,
            isJumping: false,
            facingRight: true,
            
            update() {
                // Movement
                this.velocityX = 0;
                if ((keys['arrowleft'] || keys['a']) && this.x > 0) {
                    this.velocityX = -PLAYER_SPEED;
                    this.facingRight = false;
                }
                if ((keys['arrowright'] || keys['d']) && this.x < canvas.width - this.width) {
                    this.velocityX = PLAYER_SPEED;
                    this.facingRight = true;
                }
                
                this.x += this.velocityX;
                
                // Gravity
                this.velocityY += GRAVITY;
                this.y += this.velocityY;
                
                // Check collision with all platforms
                let onGround = false;
                
                // Ground collision
                if (this.y + this.height >= GROUND_Y) {
                    this.y = GROUND_Y - this.height;
                    this.velocityY = 0;
                    this.isJumping = false;
                    onGround = true;
                }
                
                // Platform collision
                platforms.forEach(platform => {
                    if (this.velocityY > 0 && 
                        this.y + this.height <= platform.y + 10 &&
                        this.y + this.height + this.velocityY >= platform.y &&
                        this.x + this.width > platform.x &&
                        this.x < platform.x + platform.width) {
                        this.y = platform.y - this.height;
                        this.velocityY = 0;
                        this.isJumping = false;
                        onGround = true;
                    }
                });
                
                // Jump input (works on ground OR platforms)
                if (keys[' '] && onGround) {
                    this.velocityY = JUMP_STRENGTH;
                    this.isJumping = true;
                    playSound('jump');
                }
            },
            
            draw() {
                // Draw student character
                ctx.fillStyle = '#ffcccb';
                ctx.fillRect(this.x, this.y, this.width, this.height * 0.6); // body
                
                ctx.fillStyle = '#ffdbac';
                ctx.fillRect(this.x + 6, this.y - 8, 8, 8); // head
                
                // Eyes
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x + 7, this.y - 6, 2, 2);
                ctx.fillRect(this.x + 13, this.y - 6, 2, 2);
                
                // Legs
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x + 4, this.y + 15, 3, 10);
                ctx.fillRect(this.x + 13, this.y + 15, 3, 10);
            }
        };
        
        // Platforms
        const platforms = [
            { x: 0, y: GROUND_Y, width: canvas.width, height: 100 }, // ground
            { x: 150, y: 450, width: 180, height: 20 },
            { x: 450, y: 380, width: 160, height: 20 },
            { x: 700, y: 320, width: 200, height: 20 },
            { x: 300, y: 280, width: 150, height: 20 },
            { x: 750, y: 420, width: 140, height: 20 },
        ];
        
        // Lion Tokens (collectibles)
        let tokens = [
            { x: 200, y: 410, collected: false },
            { x: 280, y: 410, collected: false },
            { x: 520, y: 340, collected: false },
            { x: 380, y: 240, collected: false },
            { x: 600, y: 280, collected: false },
            { x: 800, y: 280, collected: false },
            { x: 850, y: 380, collected: false },
        ];
        totalTokens = tokens.length;
        document.getElementById('tokenTotal').textContent = totalTokens;
        
        // Professor (end goal)
        const professor = {
            x: 850,
            y: GROUND_Y - 80,
            width: 24,
            height: 40,
            happy: true,
            
            draw(happy) {
                // Draw professor
                ctx.fillStyle = '#8b7355';
                ctx.fillRect(this.x, this.y, this.width, this.height * 0.5); // body
                
                ctx.fillStyle = '#ffdbac';
                ctx.fillRect(this.x + 4, this.y - 12, 16, 12); // head
                
                // Eyes
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x + 6, this.y - 8, 2, 2);
                ctx.fillRect(this.x + 14, this.y - 8, 2, 2);
                
                // Beard
                ctx.fillStyle = '#8b7355';
                ctx.fillRect(this.x + 5, this.y - 4, 14, 3);
                
                // Mouth (happy or sad)
                ctx.fillStyle = '#000';
                if (happy) {
                    ctx.arc(this.x + 12, this.y - 2, 2, 0, Math.PI);
                    ctx.stroke();
                } else {
                    ctx.arc(this.x + 12, this.y - 1, 2, Math.PI, 0);
                    ctx.stroke();
                }
                
                // Arms
                ctx.fillStyle = '#ffdbac';
                ctx.fillRect(this.x - 3, this.y + 8, 3, 8);
                ctx.fillRect(this.x + this.width, this.y + 8, 3, 8);
            }
        };
        
        // Audio context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            try {
                const now = audioContext.currentTime;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                osc.connect(gain);
                gain.connect(audioContext.destination);
                
                if (type === 'jump') {
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'collect') {
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(1000, now + 0.15);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0, now + 0.15);
                    osc.start(now);
                    osc.stop(now + 0.15);
                }
            } catch (e) {
                console.log('Audio unavailable');
            }
        }
        
        function drawPlatforms() {
            ctx.fillStyle = '#4a90e2';
            platforms.forEach(platform => {
                // Platform base
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // Platform pattern (brick-like)
                ctx.strokeStyle = '#2c5aa0';
                ctx.lineWidth = 2;
                for (let i = 0; i < platform.width; i += 40) {
                    ctx.strokeRect(platform.x + i, platform.y, 40, platform.height);
                }
            });
        }
        
        function drawTokens() {
            tokens.forEach(token => {
                if (!token.collected) {
                    // Draw lion token (simplified lion symbol)
                    ctx.fillStyle = '#ffdb58';
                    ctx.beginPath();
                    ctx.arc(token.x, token.y, 8, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Lion mane (circle outline)
                    ctx.strokeStyle = '#ffa500';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(token.x, token.y, 10, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // Eyes
                    ctx.fillStyle = '#333';
                    ctx.fillRect(token.x - 3, token.y - 2, 2, 2);
                    ctx.fillRect(token.x + 2, token.y - 2, 2, 2);
                    
                    // Mouth (smile)
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(token.x, token.y + 1, 2, 0, Math.PI);
                    ctx.stroke();
                }
            });
        }
        
        function drawBackground() {
            // Sky
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.beginPath();
            ctx.arc(100, 80, 30, 0, Math.PI * 2);
            ctx.arc(150, 80, 40, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(800, 150, 35, 0, Math.PI * 2);
            ctx.arc(850, 150, 45, 0, Math.PI * 2);
            ctx.fill();
            
            // Campus building (classroom destination)
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(800, 200, 150, 220);
            
            // Building windows
            ctx.fillStyle = '#ffff99';
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 4; j++) {
                    ctx.fillRect(815 + i * 35, 220 + j * 40, 20, 20);
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(815 + i * 35, 220 + j * 40, 20, 20);
                }
            }
            
            // Building door
            ctx.fillStyle = '#654321';
            ctx.fillRect(850, 340, 40, 80);
            ctx.fillStyle = '#ffff99';
            ctx.fillRect(860, 350, 8, 8);
            
            // Roof
            ctx.fillStyle = '#a0522d';
            ctx.beginPath();
            ctx.moveTo(800, 200);
            ctx.lineTo(925, 200);
            ctx.lineTo(875, 150);
            ctx.closePath();
            ctx.fill();
            
            // Trees
            ctx.fillStyle = '#228b22';
            ctx.beginPath();
            ctx.arc(100, 380, 30, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#654321';
            ctx.fillRect(90, 410, 20, 40);
            
            ctx.fillStyle = '#228b22';
            ctx.beginPath();
            ctx.arc(400, 350, 35, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#654321';
            ctx.fillRect(385, 385, 30, 45);
            
            // Flag pole
            ctx.fillStyle = '#666';
            ctx.fillRect(920, 150, 3, 50);
            ctx.fillStyle = '#0066cc';
            ctx.fillRect(923, 150, 30, 20);
            
            // Ground pattern
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, GROUND_Y, canvas.width, 100);
            
            // Grass tufts
            ctx.strokeStyle = '#228b22';
            ctx.lineWidth = 2;
            for (let i = 0; i < canvas.width; i += 30) {
                ctx.beginPath();
                ctx.moveTo(i, GROUND_Y);
                ctx.lineTo(i + 10, GROUND_Y - 8);
                ctx.stroke();
            }
        }
        
        function checkCollisions() {
            tokens.forEach(token => {
                if (!token.collected) {
                    const dx = player.x + player.width / 2 - token.x;
                    const dy = player.y + player.height / 2 - token.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 20) {
                        token.collected = true;
                        tokensCollected++;
                        playSound('collect');
                        document.getElementById('tokenCount').textContent = tokensCollected;
                    }
                }
            });
            
            // Check if reached professor
            if (!gameActive) return;
            
            const profCollision = (
                player.x < professor.x + professor.width &&
                player.x + player.width > professor.x &&
                player.y < professor.y + professor.height &&
                player.y + player.height > professor.y
            );
            
            if (profCollision) {
                gameActive = false;
                calculateGrade();
            }
        }
        
        function calculateGrade() {
            const percentage = (tokensCollected / totalTokens) * 100;
            let grade, letterGrade, happiness;
            
            if (percentage >= 93) {
                letterGrade = 'A';
                grade = 'EXCELLENT!';
                happiness = true;
            } else if (percentage >= 90) {
                letterGrade = 'A-';
                grade = 'EXCELLENT!';
                happiness = true;
            } else if (percentage >= 86) {
                letterGrade = 'B+';
                grade = 'GOOD!';
                happiness = true;
            } else if (percentage >= 80) {
                letterGrade = 'B';
                grade = 'GOOD!';
                happiness = true;
            } else if (percentage >= 77) {
                letterGrade = 'C+';
                grade = 'OK...';
                happiness = false;
            } else if (percentage >= 73) {
                letterGrade = 'C';
                grade = 'NEEDS IMPROVEMENT!';
                happiness = false;
            } else {
                letterGrade = 'D';
                grade = 'TERRIBLE!';
                happiness = false;
            }
            
            professor.happy = happiness;
            
            const gradeDisplay = document.getElementById('gradeDisplay');
            const gradeContent = document.getElementById('gradeContent');
            gradeContent.innerHTML = `
                <p style="font-size: 24px; margin-bottom: 10px;">üéì CLASS COMPLETE! üéì</p>
                <p>Tokens Collected: ${tokensCollected} / ${totalTokens}</p>
                <p>Score: ${percentage.toFixed(1)}%</p>
                <p style="font-size: 28px; color: #ffdb58; margin: 15px 0;">Grade: <strong>${letterGrade}</strong></p>
                <p style="font-size: 18px;">${grade}</p>
                <p style="margin-top: 15px; font-size: 14px;">Professor says: "${happiness ? 'Outstanding work!' : 'You need to attend class more often!'}"</p>
            `;
            gradeDisplay.classList.add('show');
        }
        
        function update() {
            if (gameActive) {
                player.update();
                checkCollisions();
            }
        }
        
        function draw() {
            drawBackground();
            drawPlatforms();
            drawTokens();
            player.draw();
            professor.draw(professor.happy);
            
            // Draw UI
            ctx.fillStyle = '#000';
            ctx.font = 'bold 16px Arial';
            ctx.fillText(`Tokens: ${tokensCollected}/${totalTokens}`, 20, 30);
            
            if (gameActive) {
                ctx.fillText('‚Üí Reach the Classroom! ‚Üê', canvas.width / 2 - 100, 30);
            }
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
    </script>
</body>
</html>
